(function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.templates=this.syaberi.templates!=null?this.syaberi.templates:this.syaberi.templates={},e.templates.mypage={},e.templates.mypage.list=Handlebars.compile('<div class="room">        <div class="room-inbox">            <div class="room-icon">                {{#if chatroom.isOwnerInactive}}                    <img class="icon_m" src="/img/chara.png">                {{else}}                    <a href="{{chatroom.ownerpage}}"><img class="icon_m" src="{{chatroom.ownerimage}}"></a>                {{/if}}            </div>            <div class="room-titlebox">                <h2 class="room-title"><a href="/chatrooms/{{chatroom.id}}{{#if isUrlOpen}}/open{{/if}}">{{chatroom.title}}</a></h2>                <div class="cat-icon"><a href="#">{{chatroom.category}}</a></div>                <div class="room-username">                    {{#if chatroom.isOwnerInactive}}                        by.退会済み                    {{else}}                        <a href="{{chatroom.ownerpage}}">by.{{chatroom.owner}}</a>                    {{/if}}                </div>            </div>            <div class="room-button">                <input type="button" onclick="location.href=\'/chatrooms/{{chatroom.id}}{{#if isUrlOpen}}/open{{/if}}\'" class="button_yg" value="話す" style="cursor:pointer,">            </div>        </div>    </div>'),e.templates.mypage.profile=Handlebars.compile('<form method="" action="" style="padding-top:20px;">          <table>              <tr>                  <th class="label">ニックネーム:<div class="necessity">※必須</div></th>                  <td class="data">                      <input type="text" name="userName" id="userName" class="text-box" value="{{userName}}">                      <div id="error_userName" class="error"></div>                  </td>              </tr>              <tr>                  <th class="label">メールアドレス:<div class="necessity">※必須</div></th>                  <td class="data">                      <input type="text" name="email" id="email" class="text-box" value="{{email}}">                      <div id="error_email" class="error"></div>                  </td>              </tr>              <tr>                  <th class="label">プロフィール:</th>                  <td class="data">                      <textarea name="description" id="description" class="textarea-box">{{description}}</textarea>                      <div id="error_description" class="error"></div>                  </td>              </tr>          </table>          <div class="submit">              <input type="button" class="button_g" id="submit_1" value="保存">          </div>          <div class="deactivate">            <a href="/confirm_deactivation">シャベリハウスを退会する</a>          </div>      </form>')}).call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.User=Backbone.Model.extend({id:null,userName:null,email:null,description:null,validation:{userName:[{required:!0,msg:"ニックネームを入力してください"},{rangeLength:[1,255],msg:"ニックネームは255文字以下で入力してください"}],email:[{required:!0,msg:"メールアドレスを入力してください"},{pattern:"email",msg:"メールアドレスの形式が不正です。"},{rangeLength:[3,255],msg:"メールアドレスは3文字以上255文字以下で入力してください"}],description:[]},url:"/users"}),e.Users=Backbone.Collection.extend({model:e.User,url:"/users"})}.call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.Chatroom=Backbone.Model.extend({id:null,title1:null,title2:null,description:null,categoryId:null,userId:null,publicYN:null,validation:{categoryId:[{required:!0,msg:"カテゴリを選択してください"}],title1:[{required:!0,msg:"部屋名を入力してください"},{rangeLength:[0,100],msg:"部屋名は100文字以下で入力してください"}],title2:[{required:!0,msg:"部屋名を入力してください"},{rangeLength:[0,100],msg:"部屋名は100文字以下で入力してください"}],description:[],publicYN:[{required:!0,msg:"公開設定を選択してください"}]},url:"/chatrooms"}),e.Chatrooms=Backbone.Collection.extend({model:e.Chatroom,url:"/chatrooms",nextPage:2,parse:function(e){return this.nextPage=e.nextPage,e.chatrooms}})}.call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.MyPageView=Backbone.View.extend({el:$("html"),events:{"click #owner-chatrooms":"getOwnerChatrooms","click #entry-chatrooms":"getEntryChatrooms","click #join-chatrooms":"getJoinChatrooms","click #edit-profile":"showProfile","click #submit_1":"editProfile","click #view-more-events":"getMore"},initialize:function(){this.model=new e.User,this.collection=new e.Chatrooms,this.mode="owner",this._csrf=$("#_csrf").val(),Backbone.Validation.bind(this)},getOwnerChatrooms:function(e){this.init_list(),$("li","#owner-chatrooms").addClass("active"),this.mode="owner",this.getChatrooms()},getEntryChatrooms:function(e){this.init_list(),$("li","#entry-chatrooms").addClass("active"),this.mode="entry",this.getChatrooms()},getJoinChatrooms:function(e){this.init_list(),$("li","#join-chatrooms").addClass("active"),this.mode="join",this.getChatrooms()},getMore:function(e){var t=this.collection.nextPage;this.getChatrooms(t)},getChatrooms:function(t){var n=this;t=t||1;var r=$("html").data("profileid");$("#view-more-events").hide(),$("#view-more-loader").show(),this.collection.fetch({data:{profileId:r,mode:this.mode,page:t},success:function(t,r){var i=r.chatrooms;i&&$.each(r.chatrooms,function(t,r){var i=e.templates.mypage.list({host:$("html").data("host"),chatroom:r,isUrlOpen:n.mode==="entry"?!1:!0});$("#article_area").append(i)}),$("#view-more-loader").hide(),r.nextPage!==0&&$("#view-more-events").show()}})},showProfile:function(t){var n=$("html").data("profilename"),r=$("html").data("profileemail"),i=$("html").data("profiledescription");this.init_list(),$("#view-more-events").hide(),$("li","#edit-profile").addClass("active");var s=e.templates.mypage.profile({userName:n,email:r,description:i});$("#article_area").append(s)},editProfile:function(e){e.preventDefault();var t=$("html").data("profileid"),n=$.trim($("#userName").val()),r=$.trim($("#email").val()),i=$.trim($("#description").val());this.model.set({userId:t,userName:n,email:r,description:i,isUpdate:!0}),this.model.isValid()&&this.model.save({userId:t,userName:n,email:r,description:i,_csrf:this._csrf},{success:function(){location.href="/mypage"},error:function(e,t){alert(t.responseText)}}),this.model.bind("validated:invalid",function(e,t){for(key in t)$("#error_"+key).text(t[key])})},render:function(){this.getOwnerChatrooms()},init_list:function(){return $("li","#owner-chatrooms").removeClass("active"),$("li","#join-chatrooms").removeClass("active"),$("li","#edit-profile").removeClass("active"),$("#article_area").empty()}})}.call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};$(function(){var t=new e.MyPageView;t.render(),Backbone.emulateHTTP=!0})}.call(this);