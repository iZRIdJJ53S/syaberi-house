(function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.templates=this.syaberi.templates!=null?this.syaberi.templates:this.syaberi.templates={},e.templates.mypage={},e.templates.mypage.list=Handlebars.compile('<article class="timeline"><div class="smatc"><div class="topthumb_b"></div><h3><a href="/chatrooms/{{chatroom.id}}{{#if isUrlOpen}}/open{{/if}}">{{chatroom.title}}</a></h3><p>{{chatroom.description}}</p><table class="table_b"><tr><td><ul class="article_ul_b" id="dec-supporters-{{chatroom.id}}"></ul></td><td class="join_b">{{chatroom.member}}<span>人<br>参加</span></td></tr></table><div class="to_detailb padt5 txtc"><a href="/chatrooms/{{chatroom.id}}{{#if isUrlOpen}}/open{{/if}}"><img src="/img/top_to_detail_b.gif" alt="詳細"></a></div></article>'),e.templates.mypage.profile=Handlebars.compile('<form action="" method=""><table id="makecommunity_table"><tr><th>ニックネーム<br><span style="color:#FF1881">※必須</span></th><td><div class="input_makecommunity_name_area"><input type="text" name="userName" id="userName" value="{{{userName}}}"></div><span id="error_userName" class="error"></span></td></tr><tr><th>メールアドレス<br><span style="color:#FF1881">※必須</span></th><td><div class="input_makecommunity_name_area"><input type="text" name="email" id="email" value="{{email}}"></div><span id="error_email" class="error"></span></td></tr><tr><th>紹介文</th><td><div class="input_makecommunity_name_area"><textarea name="description" id="description" cols="80" rows="8">{{{description}}}</textarea></div><span id="error_description" class="error"></span></td></tr></table><div class="txtc magt20 magb200"><input type="image" src="/img/makecommunity_submit.png" width="396" height="73" alt="送信" id="submit_1"></div></form>')}).call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.User=Backbone.Model.extend({id:null,userName:null,email:null,description:null,validation:{userName:[{required:!0,msg:"ニックネームを入力してください"},{rangeLength:[1,255],msg:"ニックネームは255文字以下で入力してください"}],email:[{required:!0,msg:"メールアドレスを入力してください"},{pattern:"email",msg:"メールアドレスの形式が不正です。"},{rangeLength:[3,255],msg:"メールアドレスは3文字以上255文字以下で入力してください"}],description:[]},url:"/users"}),e.Users=Backbone.Collection.extend({model:e.User,url:"/users"})}.call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.Chatroom=Backbone.Model.extend({id:null,title1:null,title2:null,description:null,categoryId:null,userId:null,publicYN:null,validation:{categoryId:[{required:!0,msg:"カテゴリを選択してください"}],title1:[{required:!0,msg:"部屋名を入力してください"},{rangeLength:[0,100],msg:"部屋名は100文字以下で入力してください"}],title2:[{required:!0,msg:"部屋名を入力してください"},{rangeLength:[0,100],msg:"部屋名は100文字以下で入力してください"}],description:[],publicYN:[{required:!0,msg:"公開設定を選択してください"}]},url:"/chatrooms"}),e.Chatrooms=Backbone.Collection.extend({model:e.Chatroom,url:"/chatrooms",nextPage:2,parse:function(e){return this.nextPage=e.nextPage,e.chatrooms}})}.call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};e.MyPageView=Backbone.View.extend({el:$("html"),events:{"click #owner-chatrooms":"getOwnerChatrooms","click #entry-chatrooms":"getEntryChatrooms","click #join-chatrooms":"getJoinChatrooms","click #edit-profile":"showProfile","click #submit_1":"editProfile","click #view-more-events":"getMore"},initialize:function(){this.model=new e.User,this.collection=new e.Chatrooms,this.mode="owner",Backbone.Validation.bind(this)},getOwnerChatrooms:function(e){this.init_list(),$("#ownerChatrooms").addClass("on"),this.mode="owner",this.getChatrooms()},getEntryChatrooms:function(e){this.init_list(),$("#entryChatrooms").addClass("on"),this.mode="entry",this.getChatrooms()},getJoinChatrooms:function(e){this.init_list(),$("#joinChatrooms").addClass("on"),this.mode="join",this.getChatrooms()},getMore:function(e){var t=this.collection.nextPage;this.getChatrooms(t)},getChatrooms:function(t){var n=this;t=t||1;var r=$("html").data("profileid");$("#view-more-events").hide(),$("#view-more-loader").show(),this.collection.fetch({data:{profileId:r,mode:this.mode,page:t},success:function(t,r){var i=r.chatrooms;i&&$.each(r.chatrooms,function(t,r){var i=e.templates.mypage.list({chatroom:r,isUrlOpen:n.mode==="entry"?!1:!0});$("#article_area").append(i)}),$("#view-more-loader").hide(),r.nextPage!==0&&$("#view-more-events").show()}})},showProfile:function(t){var n=$("html").data("profilename"),r=$("html").data("profileemail"),i=$("html").data("profiledescription");this.init_list();var s=e.templates.mypage.profile({userName:n,email:r,description:i});$("#article_area").append(s)},editProfile:function(e){e.preventDefault();var t=$("html").data("profileid"),n=$.trim($("#userName").val()),r=$.trim($("#email").val()),i=$.trim($("#description").val());this.model.set({userId:t,userName:n,email:r,description:i,isUpdate:!0}),this.model.isValid()&&this.model.save({userId:t,userName:n,email:r,description:i},{success:function(){location.href="/mypage"},error:function(e,t){alert(t.responseText)}}),this.model.bind("validated:invalid",function(e,t){for(key in t)$("#error_"+key).text(t[key])})},render:function(){this.getOwnerChatrooms()},init_list:function(){return $("article","#hakunetsu_area").removeClass("on"),$("#article_area").empty()}})}.call(this),function(){var e=this.syaberi!=null?this.syaberi:this.syaberi={};$(function(){var t=new e.MyPageView;t.render(),Backbone.emulateHTTP=!0})}.call(this);